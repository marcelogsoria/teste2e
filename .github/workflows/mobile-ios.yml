name: Test Mobile Wikipedia con Maestro - IOS

on:
  workflow_dispatch:

jobs:
  ios-sim:
    runs-on: macos-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: List available simulators
        run: xcrun simctl list devices

      - name: Boot iOS Simulator (iPhone 16)
        id: boot-simulator
        run: |
          # Buscar iPhone 16 (puede ser iPhone 16, iPhone 16 Pro, etc.)
          UDID=$(xcrun simctl list devices available | grep -i "iPhone 16" | grep -v "unavailable" | head -1 | grep -oE "[A-F0-9-]{36}")

          if [ -z "$UDID" ]; then
            echo "No se encontró iPhone 16 disponible. Listando todos los dispositivos:"
            xcrun simctl list devices available
            exit 1
          fi

          echo "UDID encontrado: $UDID"
          echo "udid=$UDID" >> $GITHUB_OUTPUT

          echo "Booting simulator $UDID"
          xcrun simctl boot "$UDID" || true

          echo "Abriendo Simulator"
          open -a Simulator

      - name: Wait until simulator is ready
        run: |
          UDID="${{ steps.boot-simulator.outputs.udid }}"
          echo "Esperando a que el simulador $UDID esté listo..."
          xcrun simctl bootstatus "$UDID" -b

      # Ejemplo opcional: correr tests con Xcode
      # - name: Run iOS tests
      #   run: xcodebuild test -scheme YourApp -destination "platform=iOS Simulator,name=iPhone 14"
